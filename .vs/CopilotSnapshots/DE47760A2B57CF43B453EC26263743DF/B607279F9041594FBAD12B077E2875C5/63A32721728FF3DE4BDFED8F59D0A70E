Texture2DArray ShadowMapArray : register(t0);
SamplerState Sampler : register(s0);

struct PSInput
{
    float4 position : SV_POSITION;
    float2 uv : TEXCOORD;
};

float4 main(PSInput input) : SV_TARGET
{
    // Display all 4 cascades in a 2x2 grid
    float2 uv = input.uv;
    int cascadeIndex = 0;
    
    // Determine which quadrant we're in
    if (uv.x >= 0.5f && uv.y < 0.5f)
    {
        cascadeIndex = 1;
        uv.x = (uv.x - 0.5f) * 2.0f;
        uv.y = uv.y * 2.0f;
    }
    else if (uv.x < 0.5f && uv.y >= 0.5f)
    {
        cascadeIndex = 2;
        uv.x = uv.x * 2.0f;
        uv.y = (uv.y - 0.5f) * 2.0f;
    }
    else if (uv.x >= 0.5f && uv.y >= 0.5f)
    {
        cascadeIndex = 3;
        uv.x = (uv.x - 0.5f) * 2.0f;
        uv.y = (uv.y - 0.5f) * 2.0f;
    }
    else
    {
        uv.x = uv.x * 2.0f;
        uv.y = uv.y * 2.0f;
    }
    
    float depth = ShadowMapArray.Sample(Sampler, float3(uv, cascadeIndex)).r;
    
    // Visualize depth with better contrast
    return float4(depth, depth, depth, 1.0f);
}